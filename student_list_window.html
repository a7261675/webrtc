<html>
    <head>
    </head>
    <body>
      <div>
        <label id="student_id_label">學號</label>
        <input type="text" name="student_id_input" id="student_id_input" placeholder="請輸入學號">
        <label id="student_name_label">學生姓名</label>
        <input type="text" name="student_name_input" id="student_name_input" placeholder="請輸入學生姓名">
        <button id="add_student_list_btn">新增學生資料</button>
        <p id="error_message"></p>
      </div>
      <div id="student_list">
        <table id="student_list_table">
            <tr>
              <th>學號</th>
              <th>姓名</th>
              <th>刪除學生</th>
            </tr>
          </table>
      </div>
    </body>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        $("#add_student_list_btn").click(function() {
            if($("#student_id_input").val() == 0) {
                $("#error_message").text("請輸入學號");
            } else if($("#student_name_input").val() == 0) {
                $("#error_message").text("請輸入學生姓名");
            }

            var student = {};
            student.id = $('input[name=student_id_input]').val();
            student.name = $('input[name=student_name_input]').val();
            $.ajax({
                data: {student_data: student},
                url: '/add_student_data', 
                dataType: 'json',
                method: 'post',
                cache: false,
                timeout: 5000
            })
            .done(function(data){
                if(data.result == 1) {
                    $("#student_list_table").append(`
                        <tr id="student_data_${student.id}">
                            <td>${student.id}</td>
                            <td>${student.name}</td>
                            <td><button onclick="delete_student_data(${student.id})">X</button></td>
                        </tr>
                    `);
                }
            })
            .fail(function(data){
                console.log(data);
                console.log("add student data failed!!!!!");
            });
        });

        function delete_student_data(i) {
            $.ajax({
                url: '/delete_student_data/' + i, 
                type: 'delete',
                contentType: 'application/json'
            })
            .done(function(data){
                if(data.result == 1) {
                    $("#student_data_"+i).empty();
                }
                console.log("delete student data success");
            })
            .fail(function(data){
                console.log(data);
                console.log("delete student data failed!!!!!");
            });
        }

        function get_student_list() {
            $.ajax({
                url: '/get_student_data', 
                type: 'get',
                contentType: 'application/json'
            })
            .done(function(data){
                student_data_list = data.student_data_list;
                student_data_list.forEach(function(student_data, index, student_data_list) {
                    $("#student_list_table").append(`
                        <tr id="student_data_${student_data.id}">
                            <td>${student_data.id}</td>
                            <td>${student_data.name}</td>
                            <td><button onclick="delete_student_data(${student_data.id})">X</button></td>
                        </tr>
                    `);
                });
                console.log(student_data_list);
                console.log("get student data success");
            })
            .fail(function(data){
                console.log(data);
                console.log("get student data failed!!!!!");
            });
        }

        get_student_list();
    </script>
</html>